# Implementation Plan: Integrated RAG Chatbot

**Branch**: `002-rag-chatbot-backend` | **Date**: 2025-12-29 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `specs/002-rag-chatbot-backend/spec.md`

## Summary

This plan outlines the creation of a backend RAG (Retrieval-Augmented Generation) chatbot. The chatbot will be located in a `/backend` directory and built using FastAPI. It will leverage the OpenAI SDK to interact with a Gemini model, use Qdrant as a vector store for book content, and connect to a Neon serverless Postgres database for chat history management.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: FastAPI, AsyncOpenAI, qdrant-client, asyncpg, uvloop
**Storage**: Neon Serverless Postgres (chat history), Qdrant Cloud (vectorized book content)
**Testing**: Pytest
**Target Platform**: Linux Server (or any container-based environment)
**Project Type**: Web Application (Backend only)
**Performance Goals**: <3s p95 response time for queries.
**Constraints**: Must use the specified Gemini OpenAI-compatible endpoint. Must operate within the free/dev tiers of Neon and Qdrant Cloud for the initial implementation.
**Scale/Scope**: The initial scope is a single chatbot serving content from one book for a small, well-defined user base.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **I. ROS 2 as the Core Framework**: ❌ **VIOLATION**. This feature is a standard web backend and uses FastAPI, not ROS 2.
- **II. NVIDIA Isaac for Simulation and Perception**: ❌ **VIOLATION**. Not applicable; this is not a simulation or perception task.
- **III. Modular and Composable Packages**: ✅ **PASS**. The FastAPI application will be structured into modular Python packages (e.g., for API, services, data models).
- **IV. Safety-First Design**: (N/A) Not a physical robot; standard web security practices will apply but the specific HRI safety rules are not relevant.
- **V. Strict Data-Driven Development**: (N/A) Not an algorithm for perception or control.
- **VI. Comprehensive Documentation**: ✅ **PASS**. API documentation will be automatically generated by FastAPI, and a `quickstart.md` will be created.
- **Technology Stack (ROS 2 Humble, C++)**: ❌ **VIOLATION**. The feature requires a web stack (Python, FastAPI), which is entirely different from the mandated robotics stack.

**GATE ASSESSMENT: FAILED**. The violations are necessary and justified below. Proceeding with caution.

## Project Structure

### Documentation (this feature)

```text
specs/002-rag-chatbot-backend/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── models/          # Pydantic models for API and data
│   ├── services/        # Business logic for RAG, DB access
│   └── api/             # FastAPI endpoints
└── tests/
    ├── integration/
    └── unit/
```

**Structure Decision**: The project structure will follow the 'Web Application (backend only)' model. A `/backend` directory will be created at the repository root to house all source code, including a `src` directory for the main application logic and a `tests` directory.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| Use of non-ROS 2/NVIDIA stack | The feature is a standard web-based RAG chatbot. The mandated ROS 2/robotics stack is entirely unsuited for this purpose. | The 'simpler' alternative of using the constitution-mandated stack is not just complex, it is technically inappropriate and infeasible for building a web service. |
